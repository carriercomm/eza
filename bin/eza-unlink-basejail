#!/bin/sh

JAILNAME=$1

if [ "x" != "x${JAILNAME}" ]; then
    for i in bin boot lib libexec rescue sbin \
        usr/bin usr/include usr/lib usr/lib32 usr/libdata usr/libexec usr/ports \
        usr/sbin usr/share usr/src ; do
                                            rm  /usr/jails/${JAILNAME}/${i}
        rsync -vialP /usr/jails/basejail/${i}/  /usr/jails/${JAILNAME}/${i}/
    done
    [ -e /etc/resolv.conf ] \
        && [ ! -e /usr/jails/${JAILNAME}/etc/resolv.conf ] \
        && cp /etc/resolv.conf /usr/jails/${JAILNAME}/etc/
    [ -e ~/bin/fres ] \
        && [ ! -e /usr/jails/${JAILNAME}/root/fres ] \
        && cp ~/bin/fres /usr/jails/${JAILNAME}/root/
    [ -e /usr/local/sbin/pkg-static ] \
        && [ ! -e /usr/jails/${JAILNAME}/sbin/pkg-static ] \
        && cp -a /usr/local/sbin/pkg-static /usr/jails/${JAILNAME}/sbin/
    eza console -f -e "freebsd-update fetch" ${JAILNAME}
    eza console -f -e "freebsd-update install" ${JAILNAME}
    eza console -f -e "pkg-static install -y pkg git" ${JAILNAME}
    eza console -f -e "sh /root/fres" ${JAILNAME}
    eza console -f -e "rm /root/fres" ${JAILNAME}
else
    echo "ERROR: missing jail name" >&2
    exit 1
fi
